<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tic Tac Toe</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <main class="layout">
    <h1 class="title">Tic Tac Toe</h1>
    <table class="board" role="grid" aria-label="Tic Tac Toe board">
      <tbody>
        <tr>
          <td data-row="0" data-col="0"></td>
          <td data-row="0" data-col="1"></td>
          <td data-row="0" data-col="2"></td>
        </tr>
        <tr>
          <td data-row="1" data-col="0"></td>
          <td data-row="1" data-col="1"></td>
          <td data-row="1" data-col="2"></td>
        </tr>
        <tr>
          <td data-row="2" data-col="0"></td>
          <td data-row="2" data-col="1"></td>
          <td data-row="2" data-col="2"></td>
        </tr>
      </tbody>
    </table>
    <p class="message" role="status" aria-live="polite"></p>
  </main>

  <footer class="site-footer">
    <a href="#about-rules" class="about-link" id="about-link" aria-expanded="false" aria-controls="about-rules">About &amp; Rules</a>
  </footer>

  <section id="about-rules" class="about-panel" hidden tabindex="-1" aria-labelledby="about-heading">
    <h2 id="about-heading">About this Tic Tac Toe project</h2>
    <p>This browser-based version of Tic Tac Toe lets you challenge a friend or sharpen your strategy against an adaptive AI opponent.</p>

    <h3>How to play</h3>
    <ul>
      <li>Players take turns placing their symbol on the 3&times;3 grid. X always begins the game.</li>
      <li>Use your keyboard or mouse to mark an empty square; you cannot overwrite a played move.</li>
      <li>Win by completing a row, column, or diagonal of your symbol before your opponent does.</li>
      <li>If every square fills without a winning line, the game ends in a draw.</li>
    </ul>

    <h3>AI difficulty levels</h3>
    <ul class="difficulty-list">
      <li><strong>Casual:</strong> Makes opportunistic plays but may miss the best defensive response&mdash;ideal for newcomers.</li>
      <li><strong>Standard:</strong> Balances offense and defense using short-term lookahead for a fair challenge.</li>
      <li><strong>Master:</strong> Leverages full minimax search to avoid mistakes and will never lose if a draw is possible.</li>
    </ul>

    <button type="button" class="about-close" id="about-close">Close</button>
  </section>

  <script>
    (function () {
      const boardElement = document.querySelector('.board');
      const messageElement = document.querySelector('.message');
      const cells = Array.from(boardElement.querySelectorAll('td'));

      let currentPlayer = 'X';
      let gameOver = false;
      const boardState = [
        ['', '', ''],
        ['', '', ''],
        ['', '', '']
      ];

      function checkWin(player) {
        for (let i = 0; i < 3; i += 1) {
          if (boardState[i][0] === player && boardState[i][1] === player && boardState[i][2] === player) {
            return true;
          }
          if (boardState[0][i] === player && boardState[1][i] === player && boardState[2][i] === player) {
            return true;
          }
        }

        if (boardState[0][0] === player && boardState[1][1] === player && boardState[2][2] === player) {
          return true;
        }
        if (boardState[0][2] === player && boardState[1][1] === player && boardState[2][0] === player) {
          return true;
        }

        return false;
      }

      function checkDraw() {
        return boardState.every((row) => row.every((cell) => cell !== ''));
      }

      function handleMove(cell) {
        if (gameOver) {
          return;
        }

        const row = Number(cell.dataset.row);
        const col = Number(cell.dataset.col);

        if (boardState[row][col] !== '') {
          return;
        }

        boardState[row][col] = currentPlayer;
        cell.textContent = currentPlayer;
        cell.classList.add('is-filled');
        cell.setAttribute('aria-label', `Row ${row + 1}, column ${col + 1}, ${currentPlayer}`);
        cell.setAttribute('tabindex', '-1');

        if (checkWin(currentPlayer)) {
          messageElement.textContent = `${currentPlayer} wins!`;
          gameOver = true;
          return;
        }

        if (checkDraw()) {
          messageElement.textContent = "It's a draw!";
          gameOver = true;
          return;
        }

        currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
        messageElement.textContent = `It's ${currentPlayer}'s turn.`;
      }

      cells.forEach((cell) => {
        const row = Number(cell.dataset.row) + 1;
        const col = Number(cell.dataset.col) + 1;
        cell.setAttribute('tabindex', '0');
        cell.setAttribute('role', 'gridcell');
        cell.setAttribute('aria-label', `Row ${row}, column ${col}, empty`);
        cell.addEventListener('click', () => handleMove(cell));
        cell.addEventListener('keydown', (event) => {
          if (event.key === 'Enter' || event.key === ' ') {
            event.preventDefault();
            handleMove(cell);
          }
        });
      });

      messageElement.textContent = `It's ${currentPlayer}'s turn.`;

      const aboutLink = document.getElementById('about-link');
      const aboutPanel = document.getElementById('about-rules');
      const aboutClose = document.getElementById('about-close');

      function openAbout() {
        aboutPanel.hidden = false;
        aboutLink.setAttribute('aria-expanded', 'true');
        aboutLink.textContent = 'Hide About & Rules';
        aboutPanel.focus();
      }

      function closeAbout() {
        if (aboutPanel.hidden) {
          return;
        }
        aboutPanel.hidden = true;
        aboutLink.setAttribute('aria-expanded', 'false');
        aboutLink.textContent = 'About & Rules';
        aboutLink.focus();
      }

      aboutLink.addEventListener('click', (event) => {
        event.preventDefault();
        if (aboutPanel.hidden) {
          openAbout();
        } else {
          closeAbout();
        }
      });

      aboutClose.addEventListener('click', () => {
        closeAbout();
      });

      aboutPanel.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          event.preventDefault();
          closeAbout();
        }
      });
    })();
  </script>
</body>
</html>
